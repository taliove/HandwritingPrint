# 摹写次数功能使用说明

## 功能概述

摹写次数功能允许用户自定义每个汉字的摹写练习次数。在传统的字帖中，每个汉字通常只有1次摹写机会，现在您可以根据学习需要调整摹写次数。

## 工作原理

- **固定布局**: 每个汉字固定占用6个格子
- **示例格子**: 第1个格子显示黑色示例字，展示标准字形
- **摹写格子**: 第2到第N个格子显示灰色摹写字（N = traceCount + 1）
- **空白格子**: 剩余格子显示为空白，供自由练习

## 配置方法

### 方法1: 全局默认设置

修改 `src/config/defaults.json` 文件中的 `layout.traceCount` 参数：

```json
{
  "layout": {
    "columnCount": 12,
    "wordTotal": 48,
    "wordCount": 8,
    "boxSize": "1.5cm",
    "traceCount": 2  // 设置默认摹写次数为2次
  }
}
```

### 方法2: 单个字帖设置

#### 通过CLI界面设置

使用字帖管理CLI可以方便地设置摹写次数：

```bash
node scripts/copybook-cli.js
```

1. 选择 "📝 创建字帖" 或 "📋 管理字帖"
2. 在配置界面中会看到 "摹写次数" 选项
3. 输入1-10之间的整数（推荐1-3次）

#### 手动编辑配置文件

在字帖的配置文件（如 `字帖名.config.json`）中设置：

```json
{
  "title": "我的字帖",
  "layout": {
    "columnCount": 12,
    "wordTotal": 48,
    "wordCount": 8,
    "traceCount": 3  // 这个字帖摹写3次
  }
}
```

### 应用配置

修改配置后，需要运行以下命令更新 Typst 配置文件：

```bash
node scripts/config-manager.js update
```

## 摹写次数建议

| 摹写次数 | 每页汉字数 | 格子分配 | 适用场景 |
|---------|-----------|----------|----------|
| 1次 | 8个 | 1黑+1灰+4空白 | 快速练习，认字为主 |
| 2次 | 8个 | 1黑+2灰+3空白 | 平衡练习，推荐设置 |
| 3次 | 8个 | 1黑+3灰+2空白 | 重点练习，难字巩固 |
| 4次 | 8个 | 1黑+4灰+1空白 | 深度练习 |
| 5次 | 8个 | 1黑+5灰+0空白 | 精细练习，最大摹写次数 |

## 注意事项

1. **固定布局**: 每个汉字固定占用6个格子，每页固定显示8个汉字
2. **推荐范围**: 建议摹写次数设置在 1-3 次之间
3. **空白利用**: 未使用的格子显示为空白，可供学生自由练习
4. **配置更新**: 修改摹写次数后必须重新生成配置文件
5. **重新编译**: 配置更新后需要重新编译字帖才能看到效果

## 测试功能

运行测试脚本查看不同摹写次数的效果：

```bash
node scripts/test-trace-count.js
```

这将创建多个测试字帖，展示不同摹写次数的布局效果。

## 技术实现

### 核心逻辑

在 `src/templates/conf_py.typ` 的 `one_page` 函数中：

```typst
// 每个汉字固定占用6个格子
let index = mod(n, 6);

// 格子分配逻辑：
if index == 0 {
  // 第1个格子：黑色示例字
  boxes.push(one_box_canvas(boxSize, themeFont, wordSize, textColor, word.word, word.pinyin))
} else if index <= traceCount {
  // 第2到第(traceCount+1)个格子：灰色摹写字
  boxes.push(one_box_canvas(boxSize, themeFont, wordSize, grayTextColor, word.word, word.pinyin))
} else {
  // 剩余格子：空白
  boxes.push(one_box_canvas(boxSize, themeFont, wordSize, textColor, "", ""))
}
```

### 配置参数

- `traceCount`: 摹写次数，默认为 1
- 在 `config.typ` 中定义，由配置管理器自动生成
- 支持全局默认值和单字帖覆盖

## 示例效果

- **摹写1次**: 你(黑) 你(灰) □ □ □ □ | 好(黑) 好(灰) □ □ □ □ ...
- **摹写2次**: 你(黑) 你(灰) 你(灰) □ □ □ | 好(黑) 好(灰) 好(灰) □ □ □ ...
- **摹写3次**: 你(黑) 你(灰) 你(灰) 你(灰) □ □ | 好(黑) 好(灰) 好(灰) 好(灰) □ □ ...
- **摹写5次**: 你(黑) 你(灰) 你(灰) 你(灰) 你(灰) 你(灰) | 好(黑) 好(灰) 好(灰) 好(灰) 好(灰) 好(灰) ...

这样的设计保持了页面布局的一致性，同时让学生可以根据自己的学习进度和需要，灵活调整练习强度。空白格子还可以供学生进行额外的自由练习。 